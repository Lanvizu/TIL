# ë™ì‹œì„± ì´ìŠˆì— ëŒ€í•œ ê³ ë¯¼

OUA í”„ë¡œì íŠ¸ ì„¤ê³„ ê³¼ì •ì—ì„œ ë™ì‹œì„± ë¬¸ì œì— ëŒ€í•œ ê³ ë¯¼ì´ ë°œìƒí–ˆë‹¤.

### ê³ ë¯¼ ì‚¬í•­

1. ë“±ë¡ëœ ìƒí’ˆì— ëŒ€í•œ ìœ ì €ë“¤ì´ ì…ì°°ì„ ì§„í–‰í•œë‹¤.

2. ì…ì°°ì´ ë“±ë¡ë˜ë©´ ìƒí’ˆì˜ ì…ì°° ìµœê³ ê°€ê°€ ì—…ë°ì´íŠ¸ëœë‹¤.

3. ë‹¤ë¥¸ ìœ ì €ëŠ” í•´ë‹¹ ê°€ê²© ë³´ë‹¤ ë†’ì€ ê°€ê²©ìœ¼ë¡œ ì…ì°°ì„ ì§„í–‰í•œë‹¤.

4. ì¶”ê°€ë¡œ ë³¸ì¸ì˜ ì…ì°°ì„ ì·¨ì†Œí•  ìˆ˜ ìˆìœ¼ë©° ìµœê³  ì…ì°°ê°€ì¸ ê²½ìš° ì—…ë°ì´íŠ¸ëœë‹¤.

---

## 1. ë½ì„ ì‚¬ìš©í•˜ì§€ ì•Šì€ ê²½ìš°

- ë½ì„ ì ìš©í•˜ì§€ ì•Šìœ¼ë©´, ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ë™ì‹œì— ê°™ì€ ê°€ê²©ìœ¼ë¡œ ì…ì°°ì´ ê°€ëŠ¥í•˜ë‹¤.

- ì˜ˆë¥¼ ë“¤ì–´, ìœ ì € 2ì™€ ìœ ì € 3ì´ ê±°ì˜ ë™ì‹œì— ë™ì¼í•œ ê°€ê²©ìœ¼ë¡œ ì…ì°°ì„ ì‹œë„í•˜ë©´, ë‘ ì…ì°° ëª¨ë‘ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜ëœë‹¤.

- ì¦‰, ë™ì‹œì„± ì´ìŠˆê°€ ë°œìƒí•œë‹¤.

---

## 2. ë‚™ê´€ì  ë½(Optimistic Lock)

> product í…Œì´ë¸”ì— version ì»¬ëŸ¼ì„ ì¶”ê°€í•˜ì—¬, ë°ì´í„°ì˜ ë³€ê²½ ì´ë ¥ì„ ê´€ë¦¬í•˜ëŠ” ë°©ì‹

1. ì…ì°° ì‹œì ì— í˜„ì¬ version ê°’ì„ í™•ì¸í•˜ê³ , íŠ¸ëœì­ì…˜ì´ ì™„ë£Œë  ë•Œ ë‹¤ì‹œ í•œ ë²ˆ version ê°’ì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ ì²´í¬í•œë‹¤.

2. ë§Œì•½ íŠ¸ëœì­ì…˜ ë„ì¤‘ ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ì—¬ version ê°’ì´ ë°”ë€Œì—ˆë‹¤ë©´, í•´ë‹¹ íŠ¸ëœì­ì…˜ì€ ë¡¤ë°±ë˜ê³  retry ì •ì±…ì— ë”°ë¼ ë‹¤ì‹œ ì‹¤í–‰ëœë‹¤.

    - ì´ë•Œ, ì¬ì‹œë„ ë¡œì§ì€ ë³„ë„ë¡œ êµ¬í˜„í•´ì•¼ í•˜ë©°, ì¬ì‹œë„ ì‹¤íŒ¨ì— ëŒ€í•œ ì²˜ë¦¬ë„ í•„ìš”í•˜ë‹¤.

- ë‚™ê´€ ë½ì€ ìš”ì²­ì´ ë§ì§€ ì•Šì€ í™˜ê²½ì—ì„œëŠ” íš¨ìœ¨ì ì¼ ìˆ˜ ìˆì§€ë§Œ, ë™ì‹œì— ë§ì€ ì‚¬ìš©ìê°€ ì…ì°°í•˜ëŠ” ìƒí™©ì—ì„œëŠ” ë¡¤ë°±ê³¼ ì¬ì‹œë„ê°€ ë°˜ë³µë˜ì–´ ì„œë²„ì— í° ë¶€í•˜ê°€ ë°œìƒ ê°€ëŠ¥í•˜ë‹¤.

- ê²°ê³¼ì ìœ¼ë¡œ ì…ì°° ìš”ì²­ì´ ê¸‰ì¦í•˜ë©´ ì„±ëŠ¥ ì €í•˜ê°€ ì‹¬ê°í•´ì§€ê³ , ì½”ë“œì˜ ë³µì¡ì„±ë„ ì¦ê°€í•œë‹¤.

**ì¦‰, ê²½ë§¤ì— ë§ì€ ì‚¬ìš©ìê°€ ì°¸ì—¬í•˜ëŠ” ìƒí™©ì—ì„œëŠ” ë‚™ê´€ ë½ ë°©ì‹ì´ ì í•©í•˜ì§€ ì•Šë‹¤ê³  íŒë‹¨í–ˆë‹¤.**

---

## 3. ë¹„ê´€ì  ë½(Pessimistic Lock)

> ë°ì´í„°ë² ì´ìŠ¤ ë ˆë²¨ì—ì„œ ë°°íƒ€ì  ë½ì„ ì‚¬ìš©í•˜ì—¬ ë™ì‹œ ì ‘ê·¼ì„ ì œì–´í•˜ëŠ” ë°©ì‹

1. ìœ ì € 2ê°€ ì…ì°°ì„ ì‹œì‘í•˜ë©´ í•´ë‹¹ ìƒí’ˆì— ëŒ€í•œ ë½ì„ ì„ ì í•˜ë©°, ìœ ì € 3ì€ ìœ ì € 2ì˜ íŠ¸ëœì­ì…˜ì´ ì™„ë£Œë  ë•Œê¹Œì§€ **ëŒ€ê¸° ìƒíƒœ**ê°€ ëœë‹¤.

2. ë½ì„ íšë“í•œ íŠ¸ëœì­ì…˜ë§Œ ë°ì´í„° ìˆ˜ì •ì´ ê°€ëŠ¥í•˜ë©°, ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì€ ë½ í•´ì œ ì‹œê¹Œì§€ ì ‘ê·¼ì´ ì°¨ë‹¨ëœë‹¤.

    - ë‚™ê´€ì  ë½ê³¼ ë‹¬ë¦¬ ì¬ì‹œë„ ë¡œì§ì´ í•„ìš” ì—†ì–´ ì½”ë“œ ë³µì¡ì„±ì´ ê°ì†Œí•œë‹¤.
      
    - ë½ íšë“ ì‹¤íŒ¨ ì‹œ ì¦‰ì‹œ ì˜¤ë¥˜ë¥¼ ë°˜í™˜í•˜ë¯€ë¡œ ë¶ˆí•„ìš”í•œ ì¬ì‹œë„ ë¶€í•˜ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.

- ë‹¨ì¼ ë°ì´í„°ë² ì´ìŠ¤ í™˜ê²½ì—ì„œëŠ” ì§ê´€ì ì¸ ë™ì‹œì„± ì œì–´ê°€ ê°€ëŠ¥
  
- **ë™ì‹œì„±ì´ ë†’ì€ í™˜ê²½** ì—ì„œëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥ì´ í¬ê²Œ ì €í•˜ë  ìˆ˜ ìˆë‹¤.
  
- ë¶„ì‚° ì‹œìŠ¤í…œì˜ ê²½ìš° ì—¬ëŸ¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë™ì‹œì— DBì— ì ‘ê·¼í•˜ë©´ ë½ìœ¼ë¡œ ì¸í•œ **ë³‘ëª© í˜„ìƒ** ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

**ì¦‰, ëŒ€ê·œëª¨ ê²½ë§¤ ì„œë¹„ìŠ¤ì²˜ëŸ¼ í™•ì¥ì„±ì´ ì¤‘ìš”í•œ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” ë¹„ê´€ì  ë½ ë°©ì‹ì´ ì í•©í•˜ì§€ ì•Šë‹¤ê³  íŒë‹¨í–ˆë‹¤.**

---

## 4. SETNX ê¸°ë°˜ ì»¤ìŠ¤í…€ Redis ë¶„ì‚° ë½ (Lettuce í´ë¼ì´ì–¸íŠ¸ë¥¼ í™œìš©í•˜ì—¬ êµ¬í˜„)

> Redisì˜ SETNX ëª…ë ¹ì–´ë¥¼ í™œìš©í•œ ë¶„ì‚° ë½ êµ¬í˜„

1. **ë½ íšë“**  

   - `SETNX`(SET if Not eXists) ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • í‚¤ì— ê°’ì´ ì—†ì„ ë•Œë§Œ ê°’ì„ ì„¤ì •
     
   - `NX` ì˜µì…˜ìœ¼ë¡œ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” í‚¤ì— ëŒ€í•œ ì¤‘ë³µì„ ë°©ì§€í•˜ê³ , `PX` ì˜µì…˜ìœ¼ë¡œ TTLì„ ì„¤ì •í•˜ì—¬ ë°ë“œë½ì„ ë°©ì§€ ê°€ëŠ¥

2. **ë½ ì ìœ  ë° ëŒ€ê¸°**  

   - ìœ ì € 2ê°€ ì…ì°°ì„ ë“±ë¡í•˜ë©´ í•´ë‹¹ ìƒí’ˆì— ëŒ€í•œ ë½ì„ Redisì— ì„¤ì • 

   - ìœ ì € 3ì´ ê°™ì€ ìƒí’ˆì— ì…ì°°ì„ ì‹œë„í•˜ë©´, ë½ì´ í•´ì œë  ë•Œê¹Œì§€ Redisì— ë°˜ë³µì ìœ¼ë¡œ ë½ íšë“ ìš”ì²­ì„ ë³´ë‚´ë©° ëŒ€ê¸°

   - ë½ íšë“ ì‹œê¹Œì§€ ì¬ì‹œë„ ë¡œì§ì„ ê°œë°œìê°€ ì§ì ‘ êµ¬í˜„í•´ì•¼ í•˜ë©°, ê³¼ë„í•œ ìš”ì²­ì€ Redisì— ë¶€í•˜ë¥¼ ì¤„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì ì ˆí•œ ì§€ì—° ì²˜ë¦¬ê°€ í•„ìš”

3. **ë½ í•´ì œ**  

   - íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë˜ë©´, ë½ì„ ìƒì„±í•œ í´ë¼ì´ì–¸íŠ¸ë§Œ ìì‹ ì˜ ë½ì„ í•´ì œí•˜ë„ë¡ êµ¬í˜„

   - ë½ í•´ì œëŠ” `DEL` ëª…ë ¹ì–´ë¡œ í‚¤ë¥¼ ì‚­ì œí•˜ì—¬ ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ê°€ ë½ì„ íšë“ ê°€ëŠ¥í•˜ê²Œ í•´ì¤Œ

- DBì— ì§ì ‘ ë½ì„ ê±¸ì§€ ì•Šìœ¼ë¯€ë¡œ ì„œë²„ ë¶€í•˜ê°€ ì ê³ , ë¹ ë¥¸ ì„±ëŠ¥ê³¼ í™•ì¥ì„±

- ë³‘ëª© í˜„ìƒì´ë‚˜ ë°ë“œë½ ë°œìƒ ê°€ëŠ¥ì„±ì„ ê°ì†Œ

- Spin Lock ë°©ì‹ì´ë¯€ë¡œ ìš”ì²­ì´ ë§ì„ ê²½ìš° Redisì— ë¶€í•˜ ì§‘ì¤‘

- ë½ í•´ì œ ì‹œ ë°˜ë“œì‹œ ì†Œìœ ê¶Œì„ ê²€ì¦í•˜ì—¬, ìì‹ ì´ ìƒì„±í•œ ë½ë§Œ í•´ì œí•´ì•¼ í•¨

- ë½ íšë“ ì¬ì‹œë„ ë¡œì§ê³¼, íƒ€ì„ì•„ì›ƒ ë“± ì˜ˆì™¸ ìƒí™© ì²˜ë¦¬ê°€ í•„ìš”


~~ë¹ ë¥¸ ì„±ëŠ¥ê³¼ í™•ì¥ì„±ì´ í•„ìš”í•œ í™˜ê²½ì—ì„œ íš¨ê³¼ì ìœ¼ë¡œ í˜„ì¬ í”„ë¡œì íŠ¸ì— ì í•©í•˜ë‹¤ê³  ìƒê°í•œë‹¤.~~

**ë‹¨ì¼ ì„œë²„ì—ì„œëŠ” JVM ìˆ˜ì¤€ì˜ ë½(synchronized, ReentrantLock)ìœ¼ë¡œë„ ì¶©ë¶„í•˜ë©°, Redis ë¶„ì‚°ë½ì€ ì˜¤íˆë ¤ ì˜¤ë²„ì—”ì§€ë‹ˆì–´ë§**

---

## 5. Redission ë¶„ì‚° ë½ (Message Broker)

> Redisì˜ Pub/Sub ë©”ì»¤ë‹ˆì¦˜ì„ í™œìš©í•œ ë¶„ì‚° ë½ êµ¬í˜„ ë°©ì‹

**ì§„í–‰ ê³¼ì •**

   - ë½ íšë“ì— ì‹¤íŒ¨í•œ í´ë¼ì´ì–¸íŠ¸ëŠ” í•´ë‹¹ ë½ì˜ í•´ì œ ì‹ í˜¸ë¥¼ **subscribe** í•˜ê³  blocking ìƒíƒœë¡œ ëŒ€ê¸°

   - ë½ì´ í•´ì œë˜ë©´ **publish** ë¥¼ ë°›ê³  ì¦‰ì‹œ ì¬ì‹œë„í•˜ì—¬ ë½ì„ íšë“ 

   - ìœ ì € 2ê°€ ì…ì°°ì„ ì§„í–‰ ì¤‘ì¼ ë•Œ, ìœ ì € 3ì´ ë™ì¼í•œ ìƒí’ˆì— ì…ì²­ ì‹œë„ â†’ ë½ íšë“ ì‹¤íŒ¨ â†’ ë½ í•´ì œ ì‹ í˜¸ êµ¬ë… ìƒíƒœë¡œ ì „í™˜  

   - ìœ ì € 2ì˜ ì…ì°° ì™„ë£Œ í›„ ë½ í•´ì œ ì‹ í˜¸ ë°œí–‰ â†’ ìœ ì € 3ì´ ì‹ í˜¸ ìˆ˜ì‹  â†’ ì¦‰ì‹œ ë½ íšë“ ì¬ì‹œë„

- Lettuceì˜ ìŠ¤í•€ ë½ ë°©ì‹ë³´ë‹¤ **WAS ë¶€í•˜ ê°ì†Œ**  

- ë¸”ë¡œí‚¹ ëŒ€ê¸° ë°©ì‹ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ ë° Redis ë¶€í•˜ ìµœì†Œí™”  

- ë½ í•´ì œ ì‹œ ì¦‰ê°ì ì¸ ì¬ì‹œë„ ê°€ëŠ¥

**ë‹¨ì  ë° ì£¼ì˜ì‚¬í•­**  
   
   - ë‹¨ì¼ Redis ì¸ìŠ¤í„´ìŠ¤ì— ì˜ì¡´ â†’ ë©”ì‹œì§€ ì „ë‹¬ ì§€ì—° ì‹œ ë™ê¸°í™” ë¬¸ì œ ë°œìƒ ê°€ëŠ¥  
   
   - **ë§ˆìŠ¤í„° ë…¸ë“œ ì¥ì• ** ì‹œ ë½ ê´€ë¦¬ ë¶ˆê°€ëŠ¥  
   
   - Master-Slave ë³µì œ ì§€ì—° ì‹œ ë…¸ë“œ ê°„ ë°ì´í„° ë¶ˆì¼ì¹˜ ë°œìƒ ìœ„í—˜  
   
   - Redis í´ëŸ¬ìŠ¤í„° êµ¬ì„± ì‹œ ì¶”ê°€ì ì¸ ì„¤ì • í•„ìš”

**Pub/Sub ê¸°ë°˜ì˜ Redission ë¶„ì‚° ë½ì€ Lettuce ëŒ€ë¹„ WAS ë¶€í•˜ë¥¼ ì¤„ì¼ ìˆ˜ ìˆì§€ë§Œ, Redis ì¸í”„ë¼ì˜ ê°€ìš©ì„±ê³¼ ë³µì œ ì§€ì—° ë¬¸ì œë¥¼ ê³ ë ¤í•´ì•¼ í•¨**

---

## 6. JVM ê¸°ë°˜ ë½ (synchronized / ReentrantLock)

> ë‹¨ì¼ ì„œë²„ í™˜ê²½ì—ì„œì˜ ë™ì‹œì„± ì œì–´ë¥¼ ìœ„í•œ ê°€ì¥ ë‹¨ìˆœí•˜ê³  íš¨ê³¼ì ì¸ ë°©ë²•

- í˜„ì¬ í”„ë¡œì íŠ¸ëŠ” ë‹¨ì¼ WASì—ì„œë§Œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì—, êµ³ì´ ì™¸ë¶€ ì‹œìŠ¤í…œ(Redis ë“±)ì„ í™œìš©í•œ ë¶„ì‚° ë½ì„ êµ¬í˜„í•˜ì§€ ì•Šì•„ë„ ì¶©ë¶„í•˜ë‹¤.

- Javaì—ì„œëŠ” JVM ìˆ˜ì¤€ì˜ ë½ì„ í†µí•´ë„ ë™ì‹œì„± ì œì–´ê°€ ê°€ëŠ¥í•˜ë‹¤.

### 6-1. synchronized

- Java ê¸°ë³¸ ë¬¸ë²•ì„ í™œìš©í•œ ê°„ë‹¨í•œ ë½ êµ¬í˜„ ë°©ì‹
  
- íŠ¹ì • ë©”ì„œë“œë‚˜ ë¸”ë¡ì— synchronized í‚¤ì›Œë“œë¥¼ ë¶™ì´ë©´, í•´ë‹¹ ì½”ë“œ ë¸”ë¡ì— ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ì ‘ê·¼í•˜ì§€ ëª»í•˜ê²Œ ë§‰ì•„ì¤Œ
  
- ì‚¬ìš©ì´ ê°„í¸í•˜ê³  ì•ˆì •ì ì´ë‚˜, ë½ í•´ì œ ì‹œì ì„ ëª…í™•í•˜ê²Œ ì œì–´í•˜ê¸° ì–´ë µê³  ë¸”ë¡œí‚¹ í•´ì œê°€ ë¶ˆê°€ëŠ¥

### 6-2. ReentrantLock

- java.util.concurrent.locks.ReentrantLock ì„ ì‚¬ìš©í•´ ëª…ì‹œì ìœ¼ë¡œ ë½ì„ ê±¸ê³  í•´ì œí•  ìˆ˜ ìˆìŒ

- ë½ íšë“ì— ëŒ€í•œ íƒ€ì„ì•„ì›ƒ, ì¸í„°ëŸ½íŠ¸, ì¡°ê±´ ë³€ìˆ˜ ë“± ë‹¤ì–‘í•œ ì œì–´ ê°€ëŠ¥

- ì˜ˆì™¸ ë°œìƒ ì‹œì—ë„ finally ë¸”ë¡ì—ì„œ ë°˜ë“œì‹œ unlock í•´ì¤˜ì•¼ í•¨

- ConcurrentHashMapì„ í™œìš©í•´ ìƒí’ˆ ë‹¨ìœ„ë¡œ ì„¸ë¶„í™”ëœ ë½ ê´€ë¦¬ ê°€ëŠ¥

### ì¥ì 

- Redisë‚˜ DBì— ë¶€í•˜ë¥¼ ì£¼ì§€ ì•ŠìŒ

- ë‹¨ì¼ ì„œë²„ì—ì„œ ì¶©ë¶„í•œ ìˆ˜ì¤€ì˜ ë™ì‹œì„± ì œì–´ ì œê³µ

- ì„±ëŠ¥ì´ ë›°ì–´ë‚˜ë©° êµ¬í˜„ì´ ê°„ë‹¨

**â—ï¸ì£¼ì˜ì‚¬í•­**

- ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ë§‰ê¸° ìœ„í•´ ì‚¬ìš©ì´ ëë‚œ ë½ì€ ì£¼ê¸°ì ìœ¼ë¡œ ì •ë¦¬í•´ì•¼ í•¨

- ë½ì´ ê³¼ë„í•˜ê²Œ ë§ì•„ì§€ì§€ ì•Šë„ë¡ ì œí•œì  ê´€ë¦¬ í•„ìš”

âœ… ê²°ë¡ 

í˜„ì¬ì²˜ëŸ¼ ë‹¨ì¼ ì„œë²„ ê¸°ë°˜ì´ê³  íŠ¸ë˜í”½ì´ í­ì£¼í•˜ì§€ ì•ŠëŠ” í™˜ê²½ì—ì„œëŠ” JVM ê¸°ë°˜ ë½ë§Œìœ¼ë¡œ ì¶©ë¶„íˆ ë™ì‹œì„± ì œì–´ê°€ ê°€ëŠ¥í•˜ë‹¤.

í™•ì¥ì„±ì„ ê³ ë ¤í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ Redisë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ë¶ˆí•„ìš”í•˜ê²Œ ë³µì¡í•˜ê³  ë¦¬ìŠ¤í¬ê°€ í¬ë‹¤.

---

## ğŸ” ì¶”ê°€ì ì¸ ê³ ë ¤ì‚¬í•­: ë½ í•´ì œ ì‹œì ê³¼ íŠ¸ëœì­ì…˜ ì»¤ë°‹ ê°„ì˜ ë™ì‹œì„± ë¬¸ì œ

JMeterë¥¼ í†µí•´ ë™ì‹œ ìš”ì²­ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ë˜ ì¤‘ **ë™ì‹œì„± ë¬¸ì œê°€ ë°œìƒ**í•˜ëŠ” ìƒí™© ë°œê²¬:

> "íŠ¸ëœì­ì…˜ì´ **ì»¤ë°‹ë˜ê¸° ì „**ì— ë½ì´ ë¨¼ì € í•´ì œë˜ë©´ì„œ, ë‹¤ë¥¸ ì“°ë ˆë“œê°€ ê·¸ ë½ì„ íšë“í•˜ê³  ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìˆ˜í–‰í•´ë²„ë¦¬ëŠ” ë¬¸ì œ"

ë°ì´í„° ë¬´ê²°ì„±ì´ ê¹¨ì§ˆ ìˆ˜ ìˆê³ , íŠ¹íˆ ì…ì°° ì‹œìŠ¤í…œì´ë‚˜ ìƒíƒœ ê¸°ë°˜ì˜ ë„ë©”ì¸ ë¡œì§ì—ì„œ **ë…¼ë¦¬ì  ì¶©ëŒì´ ë°œìƒ** ê°€ëŠ¥

**ì¼ë°˜ì ìœ¼ë¡œ `ReentrantLock`ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ë½ì˜ íë¦„:**

1. ë½ íšë“ (`tryLock`)
2. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰
3. ë½ í•´ì œ (`unlock`)
4. íŠ¸ëœì­ì…˜ ì»¤ë°‹

> â— ì´ë ‡ê²Œ ë˜ë©´ **íŠ¸ëœì­ì…˜ì´ ì•„ì§ ì»¤ë°‹ë˜ì§€ ì•Šì€ ì‹œì **ì— ë½ì´ í’€ë¦´ ìˆ˜ ìˆê³ , ë‹¤ë¥¸ ìš”ì²­ì´ **Dirty Read ë˜ëŠ” ì˜ëª»ëœ ìƒíƒœ**ì— ì ‘ê·¼ ê°€ëŠ¥

### âœ… í•´ê²° ë°©ì‹: íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì´í›„ ë½ í•´ì œ

 Springì—ì„œ ì œê³µí•˜ëŠ” `TransactionSynchronizationManager`ë¥¼ í™œìš©í•˜ì—¬ **ë½ í•´ì œë¥¼ íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì´í›„ë¡œ ì§€ì—°**

```java
if (TransactionSynchronizationManager.isSynchronizationActive()) {
    TransactionSynchronizationManager.registerSynchronization(new TransactionSynchronization() {
        @Override
        public void afterCommit() {
            lock.unlock(); // ì»¤ë°‹ ì™„ë£Œ í›„ ë½ í•´ì œ
        }

        @Override
        public void afterCompletion(int status) {
            if (status != STATUS_COMMITTED) {
                lock.unlock(); // ë¡¤ë°± ì‹œì—ë„ ë½ í•´ì œ
            }
        }
    });
}
```

**ì•ˆì •ì ì¸ íë¦„** ë³´ì¥:

```
íŠ¸ëœì­ì…˜ ì‹œì‘
    â†“
ReentrantLock ë½ íšë“
    â†“
ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰
    â†“
íŠ¸ëœì­ì…˜ ì»¤ë°‹
    â†“
ë½ í•´ì œ (afterCommit ì‹œì )
```

> âœ… ì¦‰, íŠ¸ëœì­ì…˜ì´ ì™„ì „íˆ ëë‚œ ì´í›„ì—ë§Œ ë½ì´ í•´ì œë˜ë¯€ë¡œ, ê·¸ ì‚¬ì´ì— ë‹¤ë¥¸ ì“°ë ˆë“œê°€ ë½ì„ íšë“í•´ë„ **ì¼ê´€ì„± ìˆëŠ” ë°ì´í„°**ì—ë§Œ ì ‘ê·¼

---

# ê²°ë¡ 

1. ë½ ë¯¸ì‚¬ìš©

    - ë™ì‹œì„± ë¬¸ì œ ë°œìƒ

2. ë‚™ê´€ì  ë½

    - íŠ¸ë˜í”½ì´ ì ì„ ë•ŒëŠ” íš¨ìœ¨ì ì´ì§€ë§Œ, ë§ì€ ì…ì°°ì´ ë™ì‹œì— ì‹œë„ë˜ë©´ ë¡¤ë°±/ì¬ì‹œë„ë¡œ ì¸í•œ ì„±ëŠ¥ ì €í•˜ë¡œ ë¶€ì í•©í•˜ë‹¤ê³  íŒë‹¨

3. ë¹„ê´€ì  ë½

    - DB ì°¨ì›ì˜ ë°°íƒ€ ë½ì„ í†µí•´ ì •í™•í•œ ì œì–´ê°€ ê°€ëŠ¥í•˜ë‚˜, DB ë¶€í•˜ ë° ë°ë“œë½ ê°€ëŠ¥ì„±ì´ ì¡´ì¬í•´ í™•ì¥ì„± ì¸¡ë©´ì—ì„œ ë¹„íš¨ìœ¨ì 

4. Redis ê¸°ë°˜ ë¶„ì‚° ë½ (Lettuce / Redisson)

    - ë¶„ì‚° ì‹œìŠ¤í…œì—ì„œëŠ” íš¨ê³¼ì ì´ì§€ë§Œ, í˜„ì¬ ë‹¨ì¼ ì„œë²„ í™˜ê²½ì—ì„œëŠ” ê³¼ë„í•œ ì„¤ê³„ì´ë©°, Redis ì˜ì¡´ì„±ê³¼ ê´€ë¦¬ ë¶€ë‹´ì´ ì¡´ì¬

5. JVM ê¸°ë°˜ ë½ (synchronized / ReentrantLock)

    - í˜„ì¬ í”„ë¡œì íŠ¸ì˜ êµ¬ì¡°(ë‹¨ì¼ ì„œë²„, ë‚®ì€ íŠ¸ë˜í”½)ì—ì„œëŠ” ê°€ì¥ ì í•©í•œ ë°©ì‹

    - ë¹ ë¥¸ êµ¬í˜„, ë‚®ì€ ë³µì¡ë„, ì™¸ë¶€ ì˜ì¡´ì„± ì—†ìŒ

    - ìƒí’ˆ ë‹¨ìœ„ë¡œ ë½ì„ ë¶„ë¦¬í•˜ë©´ ì¶©ë¶„í•œ ìˆ˜ì¤€ì˜ ë™ì‹œì„± ì œì–´ ê°€ëŠ¥

## ìµœì¢… ì„ íƒ

âœ… **í˜„ì¬ êµ¬ì¡°ì—ì„œëŠ” JVM ë ˆë²¨ì˜ `ReentrantLock`ì„ ì‚¬ìš©í•œ ìƒí’ˆ ë‹¨ìœ„ ë½ ê´€ë¦¬ê°€ ê°€ì¥ íš¨ìœ¨ì ì´ë©° ì•ˆì •ì ì¸ ì„ íƒì´ë¼ê³  íŒë‹¨**

ë‹¨, í–¥í›„ ì„œë²„ê°€ ìˆ˜í‰ í™•ì¥ë˜ê±°ë‚˜ MSA êµ¬ì¡°ë¡œ ì „í™˜ë˜ëŠ” ê²½ìš°, Redis ê¸°ë°˜ì˜ ë¶„ì‚° ë½ìœ¼ë¡œ ì „í™˜ì„ ê³ ë ¤ ê°€ëŠ¥

> ì¶”ê°€ë¡œ TransactionSynchronizationManagerì„ í™œìš©í•˜ì—¬ íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì´í›„ ë½ í•´ì œ ì‹¤í–‰

---

### ì°¸ê³ 

https://github.com/m020202/LiveTicketing

https://hudi.blog/distributed-lock-with-redis/

https://tech.kakaopay.com/post/troubleshooting-logs-as-a-junior-developer/
