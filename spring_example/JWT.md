# JWT (Json Web Token)

- 토큰 인증 방식의 한 가지 종류로, 클라이언트가 API 요청을 할 때 토큰을 통해 인증 & 인가를 진행하는 방식 

- Json 포맷을 이용해 사용자에 대한 속성을 저장하는 Claim 기반 Web Token

- 토큰 자체를 정보로 사용하는 Self-Contained 방식으로 정보를 전달한다.

## JWT 구조

- Header, Payload, Signature의 3 부분으로 이루어지며 각 부분을 Base64Url로 인코딩되어 전달된다.

- 추가로 각각의 부분을 이어 주기 위해, '.' 구분자를 사용하여 구분한다.

> Base64Url은 암호화된 문자열이 아니며 같은 문자열에 대해 항상 같은 인코딩 문자열을 반환한다.

### Header(헤더)

- typ, alg 두 가지 정보로 구성된다.

- alg: Signature를 해싱하기 위한 알고리즘을 지정

### Payload(페이로드)

- 토큰에서 사용할 정보의 조각들인 Claim(클레임)이 담겨 있다.

- 총 3가지로 나눠지며, Json(Key/Value) 형태로 다수의 정보를 넣어 전달할 수 있다.

1. Registered Claim(등록된 클레임)

    - 이미 정해진 종류의 데이터로 토큰 정보를 표현한다.

2. Public Claim(공개 클레임)

    - 사용자 정의 클레임으로 공개용 정보를 위해 사용된다.
  
    > 충돌 방지를 위해 URI 포맷을 이용한다.

3. Private Claim(비공개 클레임)

    - 사용자 정의 클레임으로 서버와 클라이언트 사이의 임의로 지정한 정보를 저장한다.

### Signature(서명)

- 토큰을 인코딩하거나 유효성 검증을 할 때 사용하는 고유한 암호화 코드

- Signature는 헤더와 페이로드의 값을 각각 Base64Url로 인코딩한 후, 비밀 키를 이용해 헤더에서 정의한 알고리즘으로 해싱을 한다.

- 이후 다시 Base64Url로 인코딩하여 생성한다.

## JWT의 장점

- 세션을 사용하지 않아 서버가 다수 존재하는 환경에서 유용하다.

> 세션을 사용하면 모든 서버에 세션 내용을 공유해야한다.

- 매 요청마다 DB 조회를 하지 않고 토큰 자체만으로 사용자의 정보와 권한을 알 수 있으므로 병목현상을 방지한다.

## JWT의 단점

- 토큰 자체에 정보를 담고 있으므로 양날의 검이 될 수 있다.

- 페이로드에 3종류의 클레임을 저장하므로, 정보가 많아질수록 토큰의 길이가 늘어나 네트워크에 부하를 줄 수 있다.

- 페이로드 자체가 암호화 된 것이 아니므로 중간에 Payload를 탈취하여 디코딩하면 데이터를 볼 수 있다.

> JWE로 암호화를 진행하거나 Payload에 중요 데이터를 넣지 않아야 한다.

- Stateless: JWT는 상태를 저장하지 않으므로 한 번 생성되면 제어가 불가능하다.

> 토큰을 임의로 삭제가 불가능하므로, 토큰 만료 시간을 꼭 넣어줘야한다.

- 클라이언트 측에서 토큰을 관리해야하므로, 토큰을 저장해야 한다.

## Refresh Token

- Access Token이 만료될 경우 Refresh Token을 통해 새로운 Access Token을 발급받는다.

- JWT 토큰 자체에 정보를 담고 있어 보안이 매우 취약하다.

> JWT 토큰을 탈취당할 경우 해당 사용자의 권한과 정보를 모두 빼앗긴다.

- 이를 보완하기 위해 Refresh Token이 사용된다.

    - Access Token의 유효 기간은 매우 짧게 설정
 
    - Refresh Token의 유효 기간은 길게 설정

![image](https://github.com/user-attachments/assets/e2e6e7fa-d115-4db1-9e96-1b759b534993)

- Access Token의 유효 기간이 짦음에도 Refresh Token이 만료될 때 까지 추가적인 로그인을 하지 않아도 된다.

> 세션이 유지되는 것과 같은 효과

-----

### 세션과 JWT 인증 방법의 차이점

1. 확장성

    - 서버 측에서 상태를 유지하지 않기 때문에 분산 시스템에서 더 효율적이다.
  
    - 여러 서버에서 동일한 JWT를 검증할 수 있어 서버간 동기화가 필요하지 않다.
    
2. 리소스 효율성

    - 서버의 메모리를 사용하지 않아 서버 리소르를 절약할 수 있다.
    
3. 클라이언트 다양성

    - 모바일 애플리케이션, 싱글 페이지 애플리케이션(SPA), 크로스 도메인 인증 등 다양한 클라이언트 환경에서 사용하기 적합하다.
  
    - 쿠키를 사용할 수 없는 환겨에서도 JWT 인증이 가능하다.
    
4. 성능

    - 토큰 자체에 인증 정보가 담겨있어 추가적인 데이터베이스 조회를 할 필요가 없다.
  
    - 이는 인증 처리 속도를 향상시킬 수 있다.
    
5. 보안

    - 서명을 통해 데이터 무결성을 보장하므로, 토큰이 변조되면 쉽게 탐지 가능하다.
  
